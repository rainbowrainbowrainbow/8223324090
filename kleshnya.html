<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Event Maestro | –ö–ª–µ—à–Ω—è</title>
    <meta name="description" content="Event Maestro ‚Äî AI First CRM –¥–ª—è –¥–∏—Ç—è—á–∏—Ö —Ä–æ–∑–≤–∞–∂–∞–ª—å–Ω–∏—Ö —Ü–µ–Ω—Ç—Ä—ñ–≤">
    <meta property="og:title" content="Event Maestro">
    <link rel="icon" type="image/png" href="images/favicon-32.png" sizes="32x32">
    <link rel="stylesheet" href="css/base.css?v=13.1">
    <link rel="stylesheet" href="css/layout.css?v=13.1">
    <link rel="stylesheet" href="css/pages.css?v=13.1">
    <link rel="stylesheet" href="css/modals.css?v=13.1">
    <link rel="stylesheet" href="css/dark-mode.css?v=13.1">
    <link rel="stylesheet" href="css/responsive.css?v=13.1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Override main-content padding for full-bleed chat layout */
        .main-content {
            padding: 0 !important;
            max-width: none !important;
        }

        /* ==========================================
           KLESHNYA v2 ‚Äî Chat Layout with Sidebar
           ========================================== */
        .kleshnya-layout {
            display: flex;
            height: calc(100vh - 56px);
            overflow: hidden;
        }

        /* ==========================================
           SIDEBAR
           ========================================== */
        .kl-sidebar {
            width: 280px;
            flex-shrink: 0;
            background: linear-gradient(180deg, #FFF7ED 0%, #FFFBF5 100%);
            border-right: 1px solid #FDBA74;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(.4,0,.2,1);
        }

        .kl-sidebar-header {
            padding: 16px;
            flex-shrink: 0;
        }

        .kl-new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            border: 2px dashed #FDBA74;
            border-radius: 14px;
            background: rgba(255,255,255,0.7);
            color: #9A3412;
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.15s;
            min-height: 46px;
        }
        .kl-new-chat-btn:hover {
            background: #fff;
            border-color: #EA580C;
            border-style: solid;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(234,88,12,0.15);
        }
        .kl-new-chat-btn:active { transform: translateY(0); }

        .kl-sessions-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 8px 8px;
        }
        .kl-sessions-list::-webkit-scrollbar { width: 4px; }
        .kl-sessions-list::-webkit-scrollbar-thumb { background: #FDBA74; border-radius: 4px; }

        .kl-sessions-group-label {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #C2410C;
            padding: 12px 8px 4px;
        }

        .kl-session-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 2px;
            position: relative;
        }
        .kl-session-item:hover {
            background: rgba(234,88,12,0.06);
        }
        .kl-session-item.active {
            background: rgba(234,88,12,0.1);
            box-shadow: inset 3px 0 0 #EA580C;
        }
        .kl-session-item .kl-s-emoji {
            font-size: 20px;
            flex-shrink: 0;
            width: 28px;
            text-align: center;
        }
        .kl-session-item .kl-s-body {
            flex: 1;
            min-width: 0;
        }
        .kl-session-item .kl-s-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--gray-800);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .kl-session-item .kl-s-preview {
            font-size: 11px;
            color: var(--gray-400);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 1px;
        }
        .kl-session-item .kl-s-time {
            font-size: 10px;
            color: var(--gray-400);
            flex-shrink: 0;
            font-weight: 600;
        }
        .kl-session-item .kl-s-pin {
            font-size: 10px;
            position: absolute;
            top: 4px;
            right: 6px;
        }

        .kl-sidebar-footer {
            padding: 10px 16px;
            border-top: 1px solid rgba(234,88,12,0.15);
            flex-shrink: 0;
        }
        .kl-sidebar-footer .btn-report {
            width: 100%;
            padding: 8px 14px;
            border: 1px solid #FDBA74;
            border-radius: 10px;
            background: rgba(255,255,255,0.7);
            color: #9A3412;
            font-family: inherit;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .kl-sidebar-footer .btn-report:hover {
            background: #fff;
            border-color: #EA580C;
        }

        /* ==========================================
           MAIN CHAT AREA
           ========================================== */
        .kl-chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            background: var(--white);
        }

        .kl-chat-header {
            padding: 12px 20px;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
            min-height: 56px;
        }
        .kl-menu-btn {
            display: none;
            width: 40px; height: 40px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            font-size: 18px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .kl-chat-header-avatar {
            width: 36px; height: 36px;
            border-radius: 12px;
            background: linear-gradient(135deg, #EA580C, #F97316);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(234,88,12,0.2);
            flex-shrink: 0;
        }
        .kl-chat-header-info { flex: 1; min-width: 0; }
        .kl-chat-header-info h3 {
            font-size: 15px;
            font-weight: 800;
            color: var(--gray-800);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .kl-chat-header-info .kl-status {
            font-size: 11px;
            color: #059669;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .kl-status-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: #10B981;
            animation: kl-pulse-dot 2s infinite;
        }
        @keyframes kl-pulse-dot { 0%,100% { opacity:1 } 50% { opacity:0.3 } }

        /* ==========================================
           CHAT MESSAGES
           ========================================== */
        .kl-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            scroll-behavior: smooth;
        }
        .kl-messages::-webkit-scrollbar { width: 4px; }
        .kl-messages::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 4px; }

        .kl-msg {
            display: flex;
            gap: 10px;
            max-width: 80%;
            animation: kl-msg-in 0.3s ease-out;
        }
        .kl-msg--assistant { align-self: flex-start; }
        .kl-msg--user { align-self: flex-end; flex-direction: row-reverse; }
        @keyframes kl-msg-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kl-msg-avatar {
            width: 32px; height: 32px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .kl-msg--assistant .kl-msg-avatar {
            background: linear-gradient(135deg, #FFEDD5, #FED7AA);
            box-shadow: 0 2px 6px rgba(234,88,12,0.12);
        }
        .kl-msg--user .kl-msg-avatar {
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            box-shadow: 0 2px 6px rgba(16,185,129,0.12);
        }

        .kl-msg-content { min-width: 0; }

        .kl-msg-bubble {
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.55;
            white-space: pre-line;
            word-break: break-word;
        }
        .kl-msg--assistant .kl-msg-bubble {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-bottom-left-radius: 4px;
            color: var(--gray-800);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .kl-msg--user .kl-msg-bubble {
            background: linear-gradient(135deg, #10B981, #059669);
            color: #fff;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 8px rgba(16,185,129,0.2);
        }

        /* Media in bubbles */
        .kl-msg-media {
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        .kl-msg-media img {
            max-width: 100%;
            max-height: 300px;
            display: block;
            border-radius: 12px;
        }
        .kl-msg-media audio { width: 100%; min-width: 200px; }
        .kl-msg-media video {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
        }
        .kl-msg-media-caption {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
            font-style: italic;
        }

        .kl-msg-time {
            font-size: 10px;
            color: var(--gray-400);
            margin-top: 3px;
            padding: 0 2px;
            font-weight: 600;
        }
        .kl-msg--user .kl-msg-time { text-align: right; }

        /* Reactions */
        .kl-msg-reactions {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }
        .kl-reaction-btn {
            width: 30px; height: 26px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: var(--white);
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            padding: 0;
            opacity: 0.5;
        }
        .kl-reaction-btn:hover { opacity: 1; border-color: var(--gray-300); }
        .kl-reaction-btn.active {
            opacity: 1;
            border-color: #EA580C;
            background: rgba(234,88,12,0.06);
        }

        /* Skill badge */
        .kl-skill-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 6px;
            background: rgba(234,88,12,0.08);
            color: #C2410C;
            margin-bottom: 4px;
        }

        /* ==========================================
           TYPING INDICATOR
           ========================================== */
        .kl-typing {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            font-size: 12px;
            color: var(--gray-500);
            font-weight: 600;
        }
        .kl-typing-dots { display: flex; gap: 3px; }
        .kl-typing-dots span {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: #EA580C;
            opacity: 0.4;
            animation: kl-typing-bounce 1.4s infinite;
        }
        .kl-typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .kl-typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes kl-typing-bounce {
            0%,60%,100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-6px); opacity: 1; }
        }

        /* Generation progress bar */
        .kl-generating {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 12px 14px;
            background: rgba(234,88,12,0.04);
            border: 1px solid rgba(234,88,12,0.15);
            border-radius: 14px;
            max-width: 280px;
        }
        .kl-generating-text {
            font-size: 12px;
            font-weight: 700;
            color: #C2410C;
        }
        .kl-generating-bar {
            height: 4px;
            border-radius: 2px;
            background: var(--gray-100);
            overflow: hidden;
        }
        .kl-generating-bar-fill {
            height: 100%;
            border-radius: 2px;
            background: linear-gradient(90deg, #EA580C, #F97316);
            width: 0%;
            animation: kl-gen-progress 30s ease-out forwards;
        }
        @keyframes kl-gen-progress {
            0% { width: 0%; }
            50% { width: 60%; }
            80% { width: 85%; }
            100% { width: 95%; }
        }

        /* ==========================================
           INPUT AREA
           ========================================== */
        .kl-input-area {
            padding: 12px 20px 16px;
            flex-shrink: 0;
        }
        .kl-suggestions {
            display: flex;
            gap: 6px;
            padding-bottom: 8px;
            flex-wrap: wrap;
            animation: kl-fade-in 0.3s ease-out;
        }
        @keyframes kl-fade-in {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .kl-suggestion-chip {
            padding: 7px 12px;
            border: 1.5px solid #FDBA74;
            border-radius: 20px;
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            color: #9A3412;
            font-family: inherit;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
            min-height: 34px;
            display: flex;
            align-items: center;
        }
        .kl-suggestion-chip:hover {
            background: linear-gradient(135deg, #FFEDD5, #FED7AA);
            border-color: #EA580C;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(234,88,12,0.15);
        }

        .kl-input-row {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }
        .kl-input-wrap { flex: 1; position: relative; }
        .kl-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            font-family: inherit;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            min-height: 46px;
            resize: none;
            background: var(--white);
            color: var(--gray-800);
            box-sizing: border-box;
        }
        .kl-input:focus {
            border-color: #EA580C;
            box-shadow: 0 0 0 3px rgba(234,88,12,0.1);
        }
        .kl-input::placeholder { color: var(--gray-400); }

        .kl-voice-btn {
            width: 46px; height: 46px;
            border: 2px solid var(--gray-200);
            border-radius: 14px;
            background: var(--white);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            flex-shrink: 0;
            color: var(--gray-600);
        }
        .kl-voice-btn:hover { border-color: #EA580C; background: rgba(234,88,12,0.04); }
        .kl-voice-btn.recording {
            border-color: #DC2626;
            background: #FEE2E2;
            animation: kl-voice-pulse 1.5s infinite;
        }
        @keyframes kl-voice-pulse {
            0%,100% { box-shadow: 0 0 0 0 rgba(220,38,38,0.3); }
            50% { box-shadow: 0 0 0 8px rgba(220,38,38,0); }
        }

        .kl-send-btn {
            width: 46px; height: 46px;
            border: none;
            border-radius: 14px;
            background: linear-gradient(135deg, #EA580C, #C2410C);
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.15s, box-shadow 0.15s;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(234,88,12,0.25);
        }
        .kl-send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(234,88,12,0.35);
        }
        .kl-send-btn:active { transform: translateY(0); }
        .kl-send-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .kl-input-hint {
            text-align: center;
            padding: 4px 0 0;
            font-size: 11px;
            color: var(--gray-400);
            font-weight: 600;
        }

        /* ==========================================
           EMPTY STATE
           ========================================== */
        .kl-empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px 20px;
        }
        .kl-empty-icon {
            width: 80px; height: 80px;
            border-radius: 24px;
            background: linear-gradient(135deg, #EA580C, #F97316);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 8px 24px rgba(234,88,12,0.25);
        }
        .kl-empty-title {
            font-size: 20px;
            font-weight: 900;
            color: #9A3412;
        }
        .kl-empty-desc {
            font-size: 13px;
            color: var(--gray-500);
            text-align: center;
            max-width: 300px;
            line-height: 1.5;
        }

        /* ==========================================
           MOBILE FAB
           ========================================== */
        .kl-fab {
            display: none;
            position: fixed;
            bottom: 90px;
            right: 16px;
            width: 52px; height: 52px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, #EA580C, #C2410C);
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            z-index: 50;
            box-shadow: 0 4px 16px rgba(234,88,12,0.35);
            align-items: center;
            justify-content: center;
            transition: transform 0.15s;
        }
        .kl-fab:active { transform: scale(0.92); }

        /* ==========================================
           SIDEBAR OVERLAY (mobile)
           ========================================== */
        .kl-sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 199;
            backdrop-filter: blur(4px);
        }
        .kl-sidebar-overlay.visible { display: block; }

        /* ==========================================
           CONTEXT MENU
           ========================================== */
        .kl-context-menu {
            display: none;
            position: fixed;
            z-index: 300;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            padding: 6px;
            min-width: 180px;
            animation: kl-ctx-in 0.15s ease-out;
        }
        .kl-context-menu.visible { display: block; }
        @keyframes kl-ctx-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .kl-ctx-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 9px 12px;
            border: none;
            background: none;
            width: 100%;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            transition: background 0.1s;
            text-align: left;
        }
        .kl-ctx-item:hover { background: var(--gray-50); }
        .kl-ctx-item.danger { color: #DC2626; }
        .kl-ctx-item.danger:hover { background: #FEF2F2; }
        .kl-ctx-sep {
            height: 1px;
            background: var(--gray-100);
            margin: 4px 6px;
        }

        /* ==========================================
           RENAME MODAL
           ========================================== */
        .kl-rename-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(6px);
        }
        .kl-rename-overlay.visible { display: flex; }
        .kl-rename-modal {
            background: var(--white);
            border-radius: 20px;
            padding: 24px;
            max-width: 380px;
            width: 90%;
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
            animation: kl-modal-in 0.25s ease-out;
        }
        @keyframes kl-modal-in {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .kl-rename-modal h4 {
            font-size: 16px;
            font-weight: 800;
            margin: 0 0 16px;
            color: var(--gray-800);
        }
        .kl-rename-input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            box-sizing: border-box;
            min-height: 44px;
            background: var(--white);
            color: var(--gray-800);
            outline: none;
        }
        .kl-rename-input:focus { border-color: #EA580C; box-shadow: 0 0 0 3px rgba(234,88,12,0.1); }
        .kl-emoji-row {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        .kl-emoji-opt {
            width: 36px; height: 36px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            background: var(--white);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }
        .kl-emoji-opt:hover { border-color: #EA580C; }
        .kl-emoji-opt.active { border-color: #EA580C; background: rgba(234,88,12,0.06); }
        .kl-rename-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        .kl-rename-save {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #EA580C, #C2410C);
            color: #fff;
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            min-height: 44px;
        }
        .kl-rename-cancel {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: var(--white);
            color: var(--gray-600);
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            min-height: 44px;
        }

        /* ==========================================
           REPORT MODAL
           ========================================== */
        .report-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 1000;
            align-items: center; justify-content: center;
            backdrop-filter: blur(6px);
        }
        .report-overlay.visible { display: flex; }
        .report-modal {
            background: var(--white);
            border-radius: 20px;
            padding: 28px;
            max-width: 440px; width: 90%;
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
            animation: kl-modal-in 0.25s ease-out;
        }
        .report-modal h3 {
            font-size: 18px; font-weight: 900;
            margin-bottom: 20px;
            display: flex; align-items: center; gap: 8px;
            color: var(--gray-800);
        }
        .report-type-row { display: flex; gap: 8px; margin-bottom: 16px; }
        .report-type-btn {
            flex: 1; padding: 10px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: var(--gray-50);
            cursor: pointer; text-align: center;
            font-family: inherit; font-size: 13px; font-weight: 700;
            transition: all 0.15s;
            color: var(--gray-600);
        }
        .report-type-btn.active {
            border-color: #EA580C;
            background: rgba(234,88,12,0.06);
            color: #EA580C;
        }
        .report-type-btn:hover { border-color: #EA580C; }
        .report-modal label {
            display: block;
            font-size: 11px; font-weight: 800;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        .report-modal input,
        .report-modal textarea,
        .report-modal select {
            width: 100%; padding: 10px 14px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-family: inherit; font-size: 16px;
            box-sizing: border-box;
            min-height: 44px;
            background: var(--white);
            color: var(--gray-800);
            outline: none;
        }
        .report-modal input:focus,
        .report-modal textarea:focus,
        .report-modal select:focus {
            border-color: #EA580C;
            box-shadow: 0 0 0 3px rgba(234,88,12,0.1);
        }
        .report-modal textarea { resize: vertical; min-height: 80px; }
        .report-modal .form-group { margin-bottom: 14px; }
        .report-actions { display: flex; gap: 8px; margin-top: 20px; }
        .report-submit {
            flex: 1; padding: 12px;
            border: none; border-radius: 12px;
            background: linear-gradient(135deg, #EA580C, #C2410C);
            color: #fff;
            font-family: inherit; font-size: 14px; font-weight: 700;
            cursor: pointer; min-height: 44px;
            box-shadow: 0 2px 8px rgba(234,88,12,0.2);
        }
        .report-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        .report-cancel {
            flex: 1; padding: 12px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: var(--white);
            color: var(--gray-600);
            font-family: inherit; font-size: 14px; font-weight: 700;
            cursor: pointer; min-height: 44px;
        }

        /* ==========================================
           DARK MODE
           ========================================== */
        body.dark-mode .kl-sidebar {
            background: linear-gradient(180deg, #1a1520 0%, #1e1e2e 100%);
            border-color: rgba(234,88,12,0.15);
        }
        body.dark-mode .kl-new-chat-btn {
            background: rgba(255,255,255,0.04);
            border-color: rgba(234,88,12,0.3);
            color: #FDBA74;
        }
        body.dark-mode .kl-new-chat-btn:hover {
            background: rgba(234,88,12,0.1);
            border-color: rgba(234,88,12,0.5);
        }
        body.dark-mode .kl-session-item:hover { background: rgba(234,88,12,0.08); }
        body.dark-mode .kl-session-item.active { background: rgba(234,88,12,0.12); }
        body.dark-mode .kl-session-item .kl-s-title { color: #E2E8F0; }
        body.dark-mode .kl-session-item .kl-s-preview { color: rgba(255,255,255,0.3); }
        body.dark-mode .kl-session-item .kl-s-time { color: rgba(255,255,255,0.25); }
        body.dark-mode .kl-sessions-group-label { color: #FB923C; }
        body.dark-mode .kl-sidebar-footer { border-color: rgba(234,88,12,0.1); }
        body.dark-mode .kl-sidebar-footer .btn-report {
            background: rgba(255,255,255,0.04);
            border-color: rgba(234,88,12,0.2);
            color: #FDBA74;
        }

        body.dark-mode .kl-chat-area { background: #1e1e2e; }
        body.dark-mode .kl-chat-header { border-color: rgba(255,255,255,0.06); }
        body.dark-mode .kl-chat-header-info h3 { color: #E2E8F0; }
        body.dark-mode .kl-chat-header-info .kl-status { color: #6EE7B7; }
        body.dark-mode .kl-menu-btn { background: rgba(234,88,12,0.1); }

        body.dark-mode .kl-msg--assistant .kl-msg-bubble {
            background: rgba(255,255,255,0.06);
            border-color: rgba(255,255,255,0.08);
            color: #E2E8F0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }
        body.dark-mode .kl-msg--user .kl-msg-bubble {
            box-shadow: 0 2px 10px rgba(16,185,129,0.15);
        }
        body.dark-mode .kl-msg--assistant .kl-msg-avatar {
            background: linear-gradient(135deg, rgba(234,88,12,0.2), rgba(234,88,12,0.1));
        }
        body.dark-mode .kl-msg--user .kl-msg-avatar {
            background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(16,185,129,0.1));
        }
        body.dark-mode .kl-msg-time { color: rgba(255,255,255,0.25); }
        body.dark-mode .kl-reaction-btn {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
        }
        body.dark-mode .kl-reaction-btn.active {
            background: rgba(234,88,12,0.1);
            border-color: rgba(234,88,12,0.4);
        }
        body.dark-mode .kl-skill-badge {
            background: rgba(234,88,12,0.12);
            color: #FB923C;
        }

        body.dark-mode .kl-typing { color: rgba(255,255,255,0.4); }
        body.dark-mode .kl-generating {
            background: rgba(234,88,12,0.06);
            border-color: rgba(234,88,12,0.2);
        }
        body.dark-mode .kl-generating-text { color: #FB923C; }
        body.dark-mode .kl-generating-bar { background: rgba(255,255,255,0.06); }

        body.dark-mode .kl-input {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: #E2E8F0;
        }
        body.dark-mode .kl-input:focus {
            border-color: #EA580C;
            box-shadow: 0 0 0 3px rgba(234,88,12,0.15);
        }
        body.dark-mode .kl-input::placeholder { color: rgba(255,255,255,0.25); }
        body.dark-mode .kl-send-btn { box-shadow: 0 2px 10px rgba(234,88,12,0.3); }
        body.dark-mode .kl-voice-btn {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
        }
        body.dark-mode .kl-voice-btn:hover {
            border-color: rgba(234,88,12,0.5);
            background: rgba(234,88,12,0.1);
        }
        body.dark-mode .kl-voice-btn.recording {
            background: rgba(220,38,38,0.15);
            border-color: rgba(220,38,38,0.5);
        }
        body.dark-mode .kl-input-hint { color: rgba(255,255,255,0.2); }
        body.dark-mode .kl-suggestion-chip {
            background: rgba(234,88,12,0.08);
            border-color: rgba(234,88,12,0.3);
            color: #FDBA74;
        }
        body.dark-mode .kl-suggestion-chip:hover {
            background: rgba(234,88,12,0.15);
            border-color: rgba(234,88,12,0.5);
        }
        body.dark-mode .kl-msg-media-caption { color: rgba(255,255,255,0.4); }
        body.dark-mode .kl-messages::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); }

        body.dark-mode .kl-empty-title { color: #FDBA74; }
        body.dark-mode .kl-empty-desc { color: rgba(255,255,255,0.4); }

        body.dark-mode .kl-context-menu {
            background: #1e1e2e;
            border-color: rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        body.dark-mode .kl-ctx-item { color: #E2E8F0; }
        body.dark-mode .kl-ctx-item:hover { background: rgba(255,255,255,0.06); }
        body.dark-mode .kl-ctx-item.danger { color: #F87171; }
        body.dark-mode .kl-ctx-item.danger:hover { background: rgba(220,38,38,0.1); }
        body.dark-mode .kl-ctx-sep { background: rgba(255,255,255,0.06); }

        body.dark-mode .kl-rename-modal {
            background: #1e1e2e;
            border: 1px solid rgba(255,255,255,0.08);
        }
        body.dark-mode .kl-rename-modal h4 { color: #E2E8F0; }
        body.dark-mode .kl-rename-input {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: #E2E8F0;
        }
        body.dark-mode .kl-emoji-opt {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
        }
        body.dark-mode .kl-emoji-opt.active {
            border-color: #EA580C;
            background: rgba(234,88,12,0.1);
        }
        body.dark-mode .kl-rename-cancel {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
        }

        body.dark-mode .report-modal {
            background: #1e1e2e;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
        }
        body.dark-mode .report-modal h3 { color: #E2E8F0; }
        body.dark-mode .report-type-btn {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.5);
        }
        body.dark-mode .report-type-btn.active {
            border-color: #EA580C;
            background: rgba(234,88,12,0.1);
            color: #FB923C;
        }
        body.dark-mode .report-modal input,
        body.dark-mode .report-modal textarea,
        body.dark-mode .report-modal select {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: #E2E8F0;
        }
        body.dark-mode .report-modal label { color: rgba(255,255,255,0.4); }
        body.dark-mode .report-cancel {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
        }

        /* ==========================================
           RESPONSIVE
           ========================================== */
        @media (max-width: 768px) {
            .kl-sidebar {
                position: fixed;
                top: 0; left: 0; bottom: 0;
                z-index: 200;
                transform: translateX(-100%);
                width: 280px;
                box-shadow: 4px 0 24px rgba(0,0,0,0.15);
            }
            .kl-sidebar.open { transform: translateX(0); }
            .kl-menu-btn { display: flex; }
            .kl-fab { display: flex; }
            .kl-layout { height: calc(100vh - 50px); }
            .kl-messages { padding: 12px 14px; }
            .kl-input-area { padding: 10px 14px 12px; }
            .kl-msg { max-width: 88%; gap: 8px; }
            .kl-msg-avatar { width: 28px; height: 28px; font-size: 14px; border-radius: 9px; }
            .kl-msg-bubble { font-size: 13px; padding: 9px 12px; }
            .kl-chat-header { padding: 10px 14px; }
        }
    </style>
</head>
<body>
    <script>
    (function(){var s=localStorage.getItem('pzp_dark_mode');var h=new Date().getHours();var isDark=s==='true'||(s!=='false'&&(h>=20||h<7));if(isDark){document.body.classList.add('dark-mode');document.documentElement.setAttribute('data-theme','dark')}})();
    </script>

    <div id="loginScreen" class="login-screen hidden"></div>

    <div id="mainApp" class="main-app hidden">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="images/gear-logo.svg" alt="Event Maestro" class="logo-img-small">
                    <div class="em-logo">
                        <span class="em-logo-title">Event Maestro</span>
                        <span class="em-logo-sub">AI First CRM</span>
                    </div>
                </div>
                <nav class="header-nav">
                    <a href="/" class="nav-link">üìÖ <span class="nav-text">–¢–∞–π–º–ª–∞–π–Ω</span></a>
                    <a href="/tasks" class="nav-link">üìù <span class="nav-text">–ó–∞–¥–∞—á—ñ</span></a>
                    <a href="/programs" class="nav-link">üìö <span class="nav-text">–ü—Ä–æ–≥—Ä–∞–º–∏</span></a>
                    <a href="/staff" class="nav-link">üë• <span class="nav-text">–ì—Ä–∞—Ñ—ñ–∫</span></a>
                    <a href="/designs" class="nav-link">üé® <span class="nav-text">–î–∏–∑–∞–π–Ω–∏</span></a>
                    <a href="/kleshnya" class="nav-link active nav-link-kleshnya">ü¶Ä <span class="nav-text">–ö–ª–µ—à–Ω—è</span></a>
                </nav>
                <div class="user-panel">
                    <span id="currentUser" class="user-name" role="button" tabindex="0"></span>
                    <button id="logoutBtn" class="btn-logout">–í–∏–π—Ç–∏</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="kleshnya-layout kl-layout">
                <!-- Sidebar -->
                <aside class="kl-sidebar" id="klSidebar">
                    <div class="kl-sidebar-header">
                        <button class="kl-new-chat-btn" id="klNewChatBtn">‚ûï –ù–æ–≤–∏–π —á–∞—Ç</button>
                    </div>
                    <div class="kl-sessions-list" id="klSessionsList"></div>
                    <div class="kl-sidebar-footer">
                        <button class="btn-report" id="reportBtn">üêõ –§—ñ–¥–±–µ–∫</button>
                    </div>
                </aside>

                <!-- Chat Area -->
                <div class="kl-chat-area">
                    <div class="kl-chat-header">
                        <button class="kl-menu-btn" id="klMenuBtn">‚ò∞</button>
                        <div class="kl-chat-header-avatar">ü¶Ä</div>
                        <div class="kl-chat-header-info">
                            <h3 id="klChatTitle">–ö–ª–µ—à–Ω—è</h3>
                            <div class="kl-status">
                                <span class="kl-status-dot"></span>
                                <span>–û–Ω–ª–∞–π–Ω</span>
                            </div>
                        </div>
                    </div>

                    <div class="kl-messages" id="klMessages"></div>

                    <div class="kl-input-area">
                        <div class="kl-suggestions" id="klSuggestions"></div>
                        <div class="kl-input-row">
                            <div class="kl-input-wrap">
                                <input type="text" class="kl-input" id="klInput" placeholder="–ù–∞–ø–∏—Å–∞—Ç–∏ –ö–ª–µ—à–Ω—ñ..." maxlength="500" autocomplete="off">
                            </div>
                            <button class="kl-voice-btn" id="klVoiceBtn" title="–ì–æ–ª–æ—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">üé§</button>
                            <button class="kl-send-btn" id="klSendBtn" title="–ù–∞–¥—ñ—Å–ª–∞—Ç–∏">‚û§</button>
                        </div>
                        <div class="kl-input-hint" id="klHint">üìä –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è ¬∑ üìã –ó–∞–¥–∞—á—ñ ¬∑ üí∞ –§—ñ–Ω–∞–Ω—Å–∏ ¬∑ üë• –ö–æ–º–∞–Ω–¥–∞ ¬∑ üé≠ –ü—Ä–æ–≥—Ä–∞–º–∏</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile FAB -->
    <button class="kl-fab" id="klFab" title="–ù–æ–≤–∏–π —á–∞—Ç">‚úö</button>

    <!-- Sidebar overlay (mobile) -->
    <div class="kl-sidebar-overlay" id="klSidebarOverlay"></div>

    <!-- Context menu -->
    <div class="kl-context-menu" id="klContextMenu">
        <button class="kl-ctx-item" data-action="rename">‚úèÔ∏è –ü–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏</button>
        <button class="kl-ctx-item" data-action="pin">üìå –ó–∞–∫—Ä—ñ–ø–∏—Ç–∏</button>
        <button class="kl-ctx-item" data-action="clear">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
        <div class="kl-ctx-sep"></div>
        <button class="kl-ctx-item danger" data-action="delete">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
    </div>

    <!-- Rename modal -->
    <div class="kl-rename-overlay" id="klRenameOverlay">
        <div class="kl-rename-modal">
            <h4>–ü–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏ —á–∞—Ç</h4>
            <input type="text" class="kl-rename-input" id="klRenameInput" placeholder="–ù–∞–∑–≤–∞ —á–∞—Ç—É" maxlength="60">
            <div class="kl-emoji-row" id="klEmojiRow"></div>
            <div class="kl-rename-actions">
                <button class="kl-rename-save" id="klRenameSave">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button class="kl-rename-cancel" id="klRenameCancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="report-overlay" id="reportOverlay">
        <div class="report-modal">
            <h3>ü¶Ä –ü–æ–∫—Ä–∞—â–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É</h3>
            <div class="report-type-row">
                <button class="report-type-btn active" data-type="bug" id="typeBug">üêõ –ë–∞–≥</button>
                <button class="report-type-btn" data-type="improvement" id="typeImprove">üí° –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è</button>
            </div>
            <div class="form-group">
                <label>–©–æ —Å—Ç–∞–ª–æ—Å—è / —â–æ –ø–æ–∫—Ä–∞—â–∏—Ç–∏?</label>
                <input type="text" id="reportTitle" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à—ñ—Ç—å..." maxlength="200">
            </div>
            <div class="form-group">
                <label>–î–µ—Ç–∞–ª—ñ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                <textarea id="reportDesc" placeholder="–ö—Ä–æ–∫–∏ –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏, —ñ–¥–µ—ó..." maxlength="1000" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</label>
                <select id="reportPriority">
                    <option value="normal" selected>–ó–≤–∏—á–∞–π–Ω–∏–π</option>
                    <option value="high">–í–∏—Å–æ–∫–∏–π</option>
                    <option value="low">–ù–∏–∑—å–∫–∏–π</option>
                </select>
            </div>
            <div class="report-actions">
                <button class="report-submit" id="reportSubmitBtn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –°–µ—Ä–≥—ñ—é</button>
                <button class="report-cancel" id="reportCancelBtn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- v10.4: Personal cabinet modal -->
    <div id="profileModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç">
        <div class="modal-content modal-medium">
            <span class="modal-close">&times;</span>
            <h3>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h3>
            <div id="profileContent" class="profile-content">
                <div class="profile-loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
        </div>
    </div>

    <script src="js/config.js?v=13.1"></script>
    <script src="js/api.js?v=13.1"></script>
    <script src="js/auth.js?v=13.1"></script>
    <script src="js/ws.js?v=13.1"></script>
    <script src="js/kleshnya-page.js?v=13.1"></script>
</body>
</html>
